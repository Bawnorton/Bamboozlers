@inherits UserViewComponentBase

@using Bamboozlers.Classes.AppDbContext
@using Microsoft.AspNetCore.Identity

@inject IDbContextFactory<AppDbContext> Db
@inject UserManager<User> UserManager;

<br/>
<h4>Blocked: @_blockedList.Count</h4>
<hr/>
<p>@_noBlocks</p>

@foreach (var blockedUser in _blockedList)
{
    <span id="user_@blockedUser.Id" style="font-size:1.4em;">@blockedUser.UserName</span>
    <p></p>
}

@code {

    private readonly List<User> _blockedList = [];
    private string? _noBlocks;

    protected override async Task OnInitializedAsync()
    {
        if (!AuthService.IsAuthenticated().Result) return;

        var self = await AuthService.GetUser();
        await using var db = await Db.CreateDbContextAsync();
        foreach (var block in db.BlockList.Include(f => f.Blocker).Include(f => f.Blocked))
        {
            if (block.BlockerID == self!.Id)
            {
                _blockedList.Add(block.Blocked);
            }
        }

        if (_blockedList.Count == 0)
        {
            _noBlocks = "You do not have anyone blocked at this time";
        }
    }

}